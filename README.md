# GStreamerでAppSinkを使うサンプル

## 1. 何をするサンプル?
GStreamerのパイプラインで取得したフレームを独自処理したい!ということで、まずは簡単に各フレームのRGBプレーンの平均値を取得し、CSVに書き込んでいる。

GStreamerで動画の各フレームを独自に処理する方法として、AppSinkを使う方法がある。  
AppSinkをパプラインの出口に設定することで、AppSinkに渡したクロージャが所定のタイミング事に呼び出される。  

本サンプルコードでは、
```rust
AppSinkCallBackBuilder::new_sample()
```
を利用することで、サンプル毎(このパイプラインでは直前に`video/x-raw`が置かれているのでフレーム毎)にクロージャが呼ばれ、AppSinkを経由してフレームを取得することができる。  

## 2. 構成
本サンプルの構成は以下  

1. `gst::parse::launch`でパイプラインを構築
2. 作成したパイプラインから(デフォルトの)名称を用いてAppSinkを取得
3. 書き込み用のCSVのWriterを準備 & 非同期アクセスのためMutex & Arcでラップ
4. フレーム番号のカウンタを用意。これも、非同期アクセスのためArcでラップ
5. AppSinkのコールバックを設定

